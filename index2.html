<!DOCTYPE html>
<html>
    <head>
        <title>Connaitre les réfugiés maliens au Niger</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		
	<link href="/css/bootstrap.min.css" rel="stylesheet">
   	
        <link rel="stylesheet" href="css/bootstrap.css">
       <script src="adm3.js"></script>
       <script type="text/javascript" src="js/header.js"></script>
        <script src="js/jquery.js"></script>
        <script src="js/d3.min.js"></script>
        <script src="js/crossfilter.v1.min.js"></script>
        <script src="js/dc.js"></script> 
	<script src="js/bootstrap.js"></script>
		
	<style type="text/css">
        div#niveaudevie-chart { 
            float: right;
        }
		
div#map { 
            float: right;
        }
		
        div#interviewsex-chart {
            float: right;
        }
        .dc-chart .deselected circle {
          stroke: none;
          fill: rgba(0,114,188,0.2);
        }
    </style>    

	    
<script>
 
</script>  
    </head>
     <body>
		<nav class="navbar navbar-inverse navbar-static-top" style="background:#0072bc">
			
			
			
		 
   				
               <h2 style="font-size:22px;color:#fff; text-align:center">Situation socio-économique des réfugiés maliens au Niger </h2>
     
			       
         
               </nav>   
	 
	<div class="container"> 
        		
				
               
				<div class="col-md-30">  
	<g>Dans le but d’apporter une réponse adéquate aux besoins d’assistance et de protection aux réfugiés 
	maliens au Niger, plusieyrs études ont été réalisée dans les sites des régions de Tillabéry 
	(Abala, Mangaizé, Tabareybarey), de Tahoua (Zone d’Accueil des Réfugiés d’Intekan) et 
	dans la zone urbaine de Niamey. L’UNHCR a assuré la coordination générale de ces études en 
	collaboration avec l’Institut de Formation et de Recherche Démographiques (IFORD) partenaire 
	technique de mise en œuvre. </g>
            </div>

		<div id="ca-chart">
<strong>Population actuelle par localite</strong>
<a class="reset" href="javascript:caChart.filterAll();dc.redrawAll();" style="display: none;">Réinitialiser</a>


<div class="clearfix"></div>
	
	<div class="row">
    <div  class="span8">





 
    <span class="reset" style="display: none;">Selected: <span class="filter"></span></span>
    </div>

    <div class="span4">
        <div id="niveaudevie-chart">
            <strong>Evolution de niveau de vie par an</strong>
            <div class="clearfix"></div>
        </div>

        <div id="interviewsex-chart">
            <strong>Répartition par sexe (%)</strong>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
	

	
<div class="clearfix"></div>

<div>
    <a href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
</div>

</div>
		   
	     
	     
			
			
			<div class='row' style="margin-left:50px">
					<div class="col-md-3" align="middle">
							<h4><gb>Organisation</gb></h4>
							
						<div id="test"></div>
					</div>
					
					<div class="col-md-6">
							<div class="row">
								<div class="col-md-6" align="middle">
									<h4><gb>Département</gb></h4>
									<div id="departement" class="col-xs-12"></div>                    
								</div>   
								<div class="col-md-6" align="middle">
									<h4><gb>Commune</gb></h4>
									<div id="commune" class="col-xs-12"></div>  
								</div>	
							</div>	
							<div class="row">
								<div class="col-xs-6" align="middle">
									<h4><gb>Etat des activités</gb></h4>
									<div id="etat" class="col-md-12"></div>                    
								</div>   
								<div class="col-xs-6" align="middle">	
									<h4><gb>Population Bénéficiaire</gb></h4>
									<div id="activity" class="col-md-12"></div>   	
								</div>	
							</div>
							
					</div>
					<div class="col-md-3" align="middle">
							<h4><gb>Bailleur</gb></h4>	
							<div id="bailleur" ></div>
							<div class="row" align="middle"></div>	
							
					</div>
							
					
			</div>
				
			
						
			
			<div class='row'>
				
							
			</div>
			
	<script type="text/javascript">


var map_chart = dc.geoChoroplethChart("#map");
 
	
var etat_chart = dc.barChart("#etat");
var sector1_chart = dc.barChart("#sector");
var pop_chart = dc.pieChart("#activity");
var organisation_chart = dc.rowChart("#organisation");	
//var dataTable = dc.dataTable("#dc-table-graph");
var departement_chart = dc.rowChart("#departement");	
var commune_chart = dc.rowChart("#commune");
var bailleur_chart = dc.rowChart("#bailleur");	

d3.csv("6W_Diffa_Mar2017.csv", function(error, data) {
  
		var cf              = crossfilter(data);
		
		
	  
		cf.etat = cf.dimension(function(d){ return d.EtatProjet; });
		cf.sector = cf.dimension(function(d){ return d.SecteurActivite; });
		cf.activity = cf.dimension(function(d){ return d.SousSecteur; });
		cf.organisation = cf.dimension(function(d){ return d.Acteur; });
		
		cf.siteaccueil = cf.dimension(function (d) {return d.SiteAccueil;});
		cf.departement = cf.dimension(function(d){ return d.Departement; });
		cf.commune = cf.dimension(function(d){ return d.Commune; });
		cf.pop = cf.dimension(function(d){ 
		
			if (d.PopulationBeneficiaire ==      "Déplacés" )
			  return "Déplacés"
			else if (d.PopulationBeneficiaire == "Déplacés/Hôtes")
			  return "Déplacés/Hôtes" 
			else if (d.PopulationBeneficiaire == "Déplacés/Hôtes/Retournés")
			  return "Déplacés/Hôtes/Réfugiés*"
			else if (d.PopulationBeneficiaire == "Déplacés/Hôtes/Réfugiés")
			  return "Déplacés/Hôtes/Réfugiés*" 	
			else if (d.PopulationBeneficiaire == "Déplacés/Retournés")
			  return "Déplacés/Réfugiés*" 
			else if (d.PopulationBeneficiaire == "Déplacés/Réfugiés")
			  return "Déplacés/Réfugiés*"   
			else if (d.PopulationBeneficiaire == "Déplacés/Réfugiés/Ménages TP")
			  return "Déplacés/Hôtes/Réfugiés*" 
			else if (d.PopulationBeneficiaire == "Déplacés/Réfugiés/Retournés")
			  return "Déplacés/Réfugiés*" 	
			else if (d.PopulationBeneficiaire == "Hôtes")
			  return "Hôtes" 
			else if (d.PopulationBeneficiaire == "Hôtes/Retournés" )
			  return "Hôtes/Réfugiés*"
			else if (d.PopulationBeneficiaire == "Hôtes/Réfugiés/Retournés")
			  return "Hôtes/Réfugiés*" 
			else if (d.PopulationBeneficiaire == "Réfugiés/Retournés" )
			  return "Réfugiés*"
			else if (d.PopulationBeneficiaire == "Réfugiés")
			  return "Réfugiés*" 
			else if (d.PopulationBeneficiaire == "Déplacés/Réfugiés/Retournés/Hôtes" )
			  return "Tous"	  
			else if (d.PopulationBeneficiaire == "Tous" )
			  return "Tous"	
			  
			else 
			  return "Tous"      
			
			}); 
		
		
		
		
		cf.dpcode = cf.dimension(function(d){ return d.Dpcode; });
		cf.bailleur = cf.dimension(function(d){ return d.Bailleur; });
		
		
		var etatValueGroupCount = cf.etat.group()
			.reduceCount(function(d) { return d.EtatProjet; }); // counts 
		var sectorValueGroupCount = cf.sector.group()
			.reduceCount(function(d) { return d.SecteurActivite; }); // counts 
		var departement = cf.departement.group();
		var commune = cf.commune.group();
		var pop = cf.pop.group();
		var activity = cf.activity.group();
		var organisation = cf.organisation.group();
		var siteaccueil = cf.siteaccueil.group();
		var dpcode = cf.dpcode.group();
		var bailleur = cf.bailleur.group();
		
		var all = cf.groupAll();  
		
	
	
map_chart.width(1000).height(350)
        .dimension(cf.dpcode)
        .group(dpcode)
        .colors(['#c7c9cb', '#ffc266'])
        .colorDomain([0, 1])
        .colorAccessor(function (d) {
            if(d>0){
                return 1;
            } else {
                return 0;
            }
        })
       .overlayGeoJson(dis.features, "District", function (d) {
            return d.properties.id3;
        })
        .projection(d3.geo.mercator().center([12.6,13.5]).scale(12000))
        .title(function(d){
            var disname="";
            dis.features.forEach(function(e){
                if(d.key == e.properties.id3){
                    disname= e.properties.name;
                }
            });
            return disname;
        })
		;
	

	
etat_chart.width(300)
		.height(280)
		.margins({top: 10, right: 10, bottom: 20, left: 40})
        .dimension(cf.etat)
        .group(etatValueGroupCount)        	
		.transitionDuration(500)
		.centerBar(false)	
		.gap(40)  // 65 = norm
		.colors("#E54143")
		.x(d3.scale.ordinal().domain(["Réalisé","En cours","Planifié"]))
		.xUnits(dc.units.ordinal)
		.elasticY(true)
		.yAxisLabel('Nombre d’activités')
		.xAxis().tickFormat();
		
bailleur_chart.width(300).height(695)
        .margins({top: 0, left: 10, right: 10, bottom: 40})
        .dimension(cf.bailleur)
        .group(bailleur)
        .elasticX(true)
		
		.data(function(group) {
            return group.top(40);
        })
        .colors(['#D68533','#4667b4','#0066FF','#FFFF00','#dd2728','#9460bd','#8c5646','#e177c2','#4f7f7f','#bcb622','#17becf','#367f0e','#9467bd','#c4fc94','#cc564b','#bcb322','#6e9ac8','#D68533'
            ])
        .colorDomain([0,17])
        .colorAccessor(function(d, i){return i%17;}) 
		.xAxis().ticks(4);	
		
sector1_chart.width(960)
		.height(250)
		.margins({top: 10, right: 50, bottom: 40, left: 50})
        .dimension(cf.sector)
        .group(sectorValueGroupCount)        	
		.transitionDuration(500)
		.centerBar(false)	
		.gap(10)  // 65 = norm
		.colors("#E54143")
		.x(d3.scale.ordinal().domain(["Abris/BNA","Education","Nutrition","Communication","Protection","Protection de l'enfance","Santé","Sécurité Alimentaire","EHA","Logistique","Relèvement Précoce"]))
		.xUnits(dc.units.ordinal)
		.elasticY(true)
		.xAxisLabel('Secteur')
		.yAxisLabel('Nombre d’activités')
		.xAxis().tickFormat(function (d) {
        return d});	
		
 		
pop_chart.width(230).height(370)
        .dimension(cf.pop)
        .group(pop)
		.radius(70)
		.innerRadius(20)
        .colors(['#e177c2','#009933' ,'#ffff00','#0059b3' ,'#f47f0e','#cccc99','#E54143','#36ff0e','#9460bd', '#8c5646'
				])

        .colorDomain([0,10])
        .colorAccessor(function(d, i){return i%10;})
		.legend(dc.legend().x(10).y(5).gap(4))
		.label(function(d) { return d.pop; })
		.renderLabel(true);		



organisation_chart.width(300).height(695)
        .margins({top: 0, left: 10, right: 10, bottom: 40})
        .dimension(cf.organisation)
        .group(organisation)
        .elasticX(true)
        .data(function(group) {
            return group.top(43);
        })
        .colors(['#1f77b4',
                 '#ff7f0e',
                 '#2ca02c',
                 '#d62728',
                 '#9467bd',
                 '#8c564b',
                 '#e377c2',
                 '#7f7f7f',
				 '#bcbd22',
                 '#17becf',
                 '#ff7f0e',
                 '#9467bd',
                 '#c49c94',
                 '#8c564b',
                 '#bcbd22',
                 '#9e9ac8'
            ])
        .colorDomain([0,8])
        .colorAccessor(function(d, i){return i%8;})
		.xAxis().ticks(4);
		
departement_chart.width(270).height(350)
        .margins({top: 0, left: 10, right: 10, bottom: 40})
        .dimension(cf.departement)
        .group(departement)
        .elasticX(true)
        .data(function(group) {
            return group.top(15);
        })
        .colors(['#1f77b4',
                 '#ff7f0e',
                 '#2ca02c',
                 '#d62728',
                 '#9467bd',
                 '#8c564b',
                 '#e377c2'
                 
            ])
        .colorDomain([0,6])
        .colorAccessor(function(d, i){return i%6;})
		.xAxis().ticks(5);

commune_chart.width(270).height(350)
        .margins({top: 0, left: 10, right: 10, bottom: 40})
        .dimension(cf.commune)
        .group(commune)
        .elasticX(true)
        .data(function(group) {
            return group.top(20);
        })
        .colors(['#7f7f7f',
				 '#bc9d22',
                 '#17becf',
                 '#427f0e',
                 '#9467bd',
                 '#c49c94',
                 '#8c564b',
                 '#fcbd22',
                 '#9e9ac8',
                 '#7f7f7f',
				 '#bcbd22',
                 '#17becf',
                 '#ff7f0e'
                 
            ])
        .colorDomain([0,12])
        .colorAccessor(function(d, i){return i%12;})
		.xAxis().ticks(5);
			
		
	
		
		dc.dataCount("#count-info")
	.dimension(cf)
	.group(all);
	
	
      dc.renderAll();
	  
	 
	  
	var g = d3.selectAll("#organisation").select("svg").append("g");
    g.append("text").attr("class", "x-axis-label").attr("text-anchor", "middle").attr("x", 150).attr("y", 685).text("Nombre d’activités");  
	  
	var g1 = d3.selectAll("#bailleur").select("svg").append("g");	
	g1.append("text").attr("class", "x-axis-label").attr("text-anchor", "middle").attr("x", 160).attr("y", 685).text("Nombre d’activités");	
	
	var g2 = d3.selectAll("#departement").select("svg").append("g");	
	g2.append("text").attr("class", "x-axis-label").attr("text-anchor", "middle").attr("x", 120).attr("y", 340).text("Nombre d’activités par département");	
	
	var g3 = d3.selectAll("#commune").select("svg").append("g");	
	g3.append("text").attr("class", "x-axis-label").attr("text-anchor", "middle").attr("x", 120).attr("y", 340).text("Nombre d’activités par commune");	
	
	var g4 = d3.selectAll("#activity").select("svg").append("g");	
	g4.append("text").attr("class", "x-axis-label").attr("text-anchor", "middle").attr("x", 120).attr("y",300).text("* : Réfugiés ou retournés");	
			
	
		
		
	var dataset = [	[150, 220, "Goudoumaria"], [230, 130,"N'Gueil Bely"], [350, 160,"Foulatari"], [310, 270,"Mainé-Soroa"], [400, 240,"Chetimari"],
							[468, 280,"Diffa"], [470, 240,"Gueskerou"], [470, 67,"N'Gourti"], [550, 210,"Toumour"], [590, 140,"Kabelawa"]	, [600, 70,"N'Guigmi"]	, [640, 190,"Bosso"]		  ];
	
	var h = d3.selectAll("#map").select("svg").append("g");
    
    h.selectAll("text")
			   .data(dataset)
			   .enter()
			   .append("text")
			   .attr("font-family", "calibri")
			   .attr("font-size", "14px")
			   .attr("stroke", "#555555")
			   .text(function(d) {
			   		return d[2];
			   })
			   .attr("x", function(d) {
			   		return d[0];
			   })
			   .attr("y", function(d) {
			   		return d[1];
			   });
	 });		   

</script>
	
		
    
<script type="text/javascript" src="/js/d3.js"></script>
<script type="text/javascript" src="/js/crossfilter.js"></script>
<script type="text/javascript" src="/js/dc.js"></script>
<script type="text/javascript">
    var numberFormat = d3.format(".2f");

    var caChart = dc.bubbleOverlay("#ca-chart")
            .svg(d3.select("#ca-chart svg"));

    var niveaudevieChart = dc.barChart("#niveaudevie-chart");

    var interviewsexChart = dc.lineChart("#interviewsex-chart");

    function isTotalCrimeRateRecord(v) {
        return v.type == "Total, all violations" && v.sub_type == "Rate per 100,000 population";
    }

    function isTotalCrimeIncidentRecord(v) {
        return v.type == "Total, all violations" && v.sub_type == "Actual incidents";
    }

    function isViolentCrimeRateRecord(v) {
        return v.type == "Total violent Criminal Code violations" && v.sub_type == "Rate per 100,000 population";
    }

    function isViolentCrimeIncidentRecord(v) {
        return v.type == "Total violent Criminal Code violations" && v.sub_type == "Actual incidents";
    }

    function isHomicideRateRecord(v) {
        return v.type == "Homicide" && v.sub_type == "Rate per 100,000 population";
    }

    function isHomicideIncidentRecord(v) {
        return v.type == "Homicide" && v.sub_type == "Actual incidents";
    }

    d3.csv("NigerFigures.csv", function(csv) {
        var data = crossfilter(csv);

        var cities = data.dimension(function(d) {
            return d.city;
        });
        var totalCrimeRateByCity = cities.group().reduce(
                function(p, v) {
                    if (isTotalCrimeRateRecord(v)) {
                        p.totalCrimeRecords++;
                        p.totalCrimeRate += +v.number;
                        p.avgTotalCrimeRate = p.totalCrimeRate / p.totalCrimeRecords;
                    }
                    if (isViolentCrimeRateRecord(v)) {
                        p.violentCrimeRecords++;
                        p.violentCrimeRate += +v.number;
                        p.avgViolentCrimeRate = p.violentCrimeRate / p.violentCrimeRecords;
                    }
                    p.violentCrimeRatio = p.avgViolentCrimeRate / p.avgTotalCrimeRate * 100;
                    return p;
                },
                function(p, v) {
                    if (isTotalCrimeRateRecord(v)) {
                        p.totalCrimeRecords--;
                        p.totalCrimeRate -= +v.number;
                        p.avgTotalCrimeRate = p.totalCrimeRate / p.totalCrimeRecords;
                    }
                    if (isViolentCrimeRateRecord(v)) {
                        p.violentCrimeRecords--;
                        p.violentCrimeRate -= +v.number;
                        p.avgViolentCrimeRate = p.violentCrimeRate / p.violentCrimeRecords;
                    }
                    p.violentCrimeRatio = p.avgViolentCrimeRate / p.avgTotalCrimeRate * 100;
                    return p;
                },
                function() {
                    return {
                        totalCrimeRecords:0,totalCrimeRate:0,avgTotalCrimeRate:0,
                        violentCrimeRecords:0,violentCrimeRate:0,avgViolentCrimeRate:0,
                        violentCrimeRatio:0
                    };
                }
        );

        var years = data.dimension(function(d) {
            return d.year; 
        });
        var crimeIncidentByYear = years.group().reduce(
                function(p, v) {
                    if (isTotalCrimeRateRecord(v)) {
                        p.totalCrimeRecords++;
                        p.totalCrime += +v.number;
                        p.totalCrimeAvg = p.totalCrime / p.totalCrimeRecords;
                    }
                    if (isViolentCrimeRateRecord(v)) {
                        p.violentCrimeRecords++;
                        p.violentCrime += +v.number;
                        p.violentCrimeAvg = p.violentCrime / p.violentCrimeRecords;
                    }
                    if(isHomicideIncidentRecord(v)){
                        p.homicide += +v.number;
                    }
                    p.nonViolentCrimeAvg = p.totalCrimeAvg - p.violentCrimeAvg;
                    return p;
                },
                function(p, v) {
                    if (isTotalCrimeRateRecord(v)) {
                        p.totalCrimeRecords--;
                        p.totalCrime -= +v.number;
                        p.totalCrimeAvg = p.totalCrime / p.totalCrimeRecords;
                    }
                    if (isViolentCrimeRateRecord(v)) {
                        p.violentCrimeRecords--;
                        p.violentCrime -= +v.number;
                        p.violentCrimeAvg = p.violentCrime / p.violentCrimeRecords;
                    }
                    if(isHomicideIncidentRecord(v)){
                        p.homicide -= +v.number;
                    }
                    p.nonViolentCrimeAvg = p.totalCrimeAvg - p.violentCrimeAvg;
                    return p;
                },
                function() {
                    return {
                        totalCrimeRecords:0,
                        totalCrime:0,
                        totalCrimeAvg:0,
                        violentCrimeRecords:0,
                        violentCrime:0,
                        violentCrimeAvg:0,
                        homicide:0,
                        nonViolentCrimeAvg:0
                    };
                }
        );

	d3.json("Geo/us-states.json", function (statesJson) {    
        caChart.width(565)
                .height(395)
                .dimension(cities)
                .group(totalCrimeRateByCity)
                .radiusValueAccessor(function(p) {
                    return p.value.avgTotalCrimeRate;
                })
                .r(d3.scale.linear().domain([0, 200000]))
                .colors(["#ff7373","#ff4040","#ff0000","#bf3030","#a60000"])
                .colorDomain([13, 30])
                .colorAccessor(function(p) {
                    return p.value.violentCrimeRatio;
                })
                .title(function(d) {
                    return "City: " + d.key
                            + "\nTotal crime per 100k population: " + numberFormat(d.value.avgTotalCrimeRate)
                            + "\nViolent crime per 100k population: " + numberFormat(d.value.avgViolentCrimeRate)
                            + "\nViolent/Total crime ratio: " + numberFormat(d.value.violentCrimeRatio) + "%";
                })
                .point("Abala", 450, 300)
                .point("Niamey", 340, 425)
                .point("Mangaize", 325, 325)
                .point("Intikane", 550, 250)
                .point("Tabareybarey", 220, 300)
                .debug(false);

        niveaudevieChart
                .width(360)
                .height(180)
                .margins({top: 40, right: 50, bottom: 30, left: 60})
                .dimension(years)
                .group(crimeIncidentByYear, "Non-Violent Crime")
                .valueAccessor(function(d) {
                    return d.value.nonViolentCrimeAvg;
                })
                .stack(crimeIncidentByYear, "Violent Crime", function(d){return d.value.violentCrimeAvg;})
                .x(d3.scale.linear().domain([1997, 2012]))
                .renderHorizontalGridLines(true)
                .centerBar(true)
                .elasticY(true)
                .brushOn(false)
                .legend(dc.legend().x(250).y(10))
                .title(function(d){
                    return d.key
                            + "\nViolent crime per 100k population: " + Math.round(d.value.violentCrimeAvg)
                            + "\nNon-Violent crime per 100k population: " + Math.round(d.value.nonViolentCrimeAvg);
                })
                .xAxis().ticks(5).tickFormat(d3.format("d"));

	
	    
	    
        interviewsexChart
               .width(360)
                .height(150)
                .margins({top: 10, right: 50, bottom: 30, left: 60})
                .dimension(years)
                .group(crimeIncidentByYear)
                .valueAccessor(function(d) {
                    return d.value.homicide;
                })
                .x(d3.scale.linear().domain([1997, 2012]))
                .renderHorizontalGridLines(true)
                .elasticY(true)
                .brushOn(true)
                .title(function(d){
                    return d.key
                            + "\nHomicide incidents: " + Math.round(d.value.homicide);
                })
                .xAxis().ticks(5).tickFormat(d3.format("d"));

        dc.renderAll();
    });
</script>
 
<script type="text/javascript">
var chart = dc.pieChart("#test");

	

d3.csv("morley.csv", function(error, experiments) {
  var ndx           = crossfilter(experiments),
      runDimension  = ndx.dimension(function(d) {return "run-"+d.Run;})
      speedSumGroup = runDimension.group().reduceSum(function(d) {return d.Speed * d.Run;});

		
  chart
    .width(200)
    .height(200)
    .slicesCap(1)
    .innerRadius(0)
    .dimension(runDimension)
    .group(speedSumGroup)
   
    // workaround for #703: not enough data is accessible through .label() to display percentages
    .on('pretransition', function(chart) {
        chart.selectAll('text.pie-slice').text(function(d) {
            return d.data.key + ' ' + dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI) * 100) + '%';
        })
    });
  chart.render();
} 
      );	
</script>	
	

    </body>
</html>
